
<!DOCTYPE html>
<html lang="zh-tw">
<head>
<!--meta http-equiv="refresh" content="60"-->    
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">
<title>車輛使用狀況表</title>

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

<style>
        body {
            padding-top: 54px;
        }
        
        a{
	margin: 10px;
        }
    
        .form-group {
            text-align: left;
        }
        
        img.img-responsive {
            height: 400px;
        }
        
        @media (min-width: 992px) {
            body {
                padding-top: 56px;
            }
        }
        
        @media (max-width: 980px) {
            img.img-responsive {
                height: 250px;
            }
        }
        
        @media (max-width: 480px) {
            img.img-responsive {
                height: 100px;
            }
        }
    </style>

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KH6W3QV');</script>

</head>
<body>   
<div class="container">
<div class="row">
<div class="col-lg-12 text-center">
<h1 class="mt-5" id="current_date"></h1>
<hr>
<div class="form-group col-xs-12">
</div>  
<div id="test"></div>
<div class="form-group col-xs-12">
<!-- button type="button" id="AllSearch" class="btn btn-primary ">全部查詢</button-->
</div>
<div class="form-group col-xs-12">
<table class="table table-striped" >
<thead>
<tr>
<th>車型</th>
<th>里程數</th>
<th>備註</th>
<th>狀態</th>
<th>使用者</th>
<th>手機</th>
<th>登記時間</th>
<th>出發地</th>
<th>同行者</th>
<th>預計回廠</th>
</tr>
</thead>
<tbody id="dataView">
    <!-- SendAllQuery(data)資料show出來-->
</tbody>
</table>
    

    
</div>
</div>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script>
    date = new Date();
    year = date.getFullYear()-1911;
    month = date.getMonth() + 1;
    day = date.getDate();
    document.getElementById("current_date").innerHTML = year + "年" +month + "月" + day + "日 車輛使用狀況表"
    
    //時間format
    Date.prototype.format =function(format){
		var o = {
			"M+" : this.getMonth()+1, //month
			"d+" : this.getDate(), //day
			"h+" : this.getHours(), //hour
			"m+" : this.getMinutes(), //minute
			"s+" : this.getSeconds(), //second
			"q+" : Math.floor((this.getMonth()+3)/3), //quarter
			"S" : this.getMilliseconds() //millisecond
		}
		if(/(y+)/.test(format)) format=format.replace(RegExp.$1,
			(this.getFullYear()+"").substr(4- RegExp.$1.length));
		for(var k in o)if(new RegExp("("+ k +")").test(format))
			format = format.replace(RegExp.$1,
				RegExp.$1.length==1? o[k] :
					("00"+ o[k]).substr((""+ o[k]).length));
		return format;
        }
  
    //查詢全部人員
        $(function() {
            //$('#AllSearch').click(function(e) {
                    var data = {
                        'action': 'carFettle'
                        }
                    SendAllQuery(data);
            //});
        });
        function AllhandleData(response) {
            var content = '';
            var Revise = ' ';
            response.forEach(element => {
                        var [car,L,B,fettle, name,phone,time,location,together,cometime] = element.data;
                        var index = element.index;
                        content +=
                            `
                            <tr>
                            <td class="car1">${car}</td>
                            <td>${L}</td>
                            <td>${B}</td>
                            <td>${fettle}</td>
                            <td>${name}</td>
                            <td>${phone}</td>
                            <td class="time" >${new Date(time).format("hh:mm")}</td>                                        
                            <td>${location}</td>
                            <td>${together}</td>
                            <td class="cometime">${new Date(cometime).format("hh:mm")}</td>
                            </tr>
                            `
        });
        if (content) {
          document.getElementsByClassName('table-striped')[0].style.display ='table'; 
        } else {
          alert('查無資料');
        }
        var dataView = document.getElementById('dataView');
        dataView.innerHTML = content;
        
        //根據車型數量
        for(i=0;i<$(".car1").length;i++){
        var settime = document.getElementsByClassName("time")[i];
        var setcometime = document.getElementsByClassName("cometime")[i];
        if (settime.innerText == 'aN:aN'){
            settime.innerText='';
            setcometime.innerText='';
        }
        }
    }
   
         
    function SendAllQuery(data){
      $.ajax({
        type: "post",
        url: "https://script.google.com/macros/s/AKfycbx5gmmJmTU-I9PLyGQCw60NaUKirz3i2o9ZnZtn5spC-KN92SrAqeEdAVfALePHA-Rkgg/exec",
        data: data,
        dataType: "JSON",
        success: function (response) {
        AllhandleData(response);
        }
      });
    }
  </script>
 
</body>
</html>
